---
layout: post
title:  "Bugcrowd 0x07 Levelup CTF"
date:   2020-08-30 16:25:10 +0545
author: machinexa
image: /writeups/assets/images/bugcrowd0x07.jpg
category: Writeups
---

I started playing this CTF and thought that i couldn't complete, but still tried. The url given was [https://07.levelupctf.com/radio](https://07.levelupctf.com/radio) and description says we are an **Agent** in top secret operation: Hack Another Day. The CTF had 7 flags in total.

# Flag 1
Visiting the url, browser gets redirected to `/login`. After trying basic SQLi payloads and default credentials, i start to look at JS files for potential attack vector. I use my custom made tool *JScanner* to extract sensitive info and we get `FLAG{504e8256b8a208845fe18a77e7b304b7}` in comment as well as new url.

# Flag 2
I downloaded an apk from that url. Since i never did apk decompiling and static code analysis it was going to be hard. For some reasons, i dont like java, still somehow i had mindset to complete the CTF. Using apktool i decompiled the apk file. 
```
root@kali-linux:~/tmp/CTF/Bugcrowd0x07/apks# apktool d communications.apk 
Picked up _JAVA_OPTIONS: -Dawt.useSystemAAFontSettings=on -Dswing.aatext=true
I: Using Apktool 2.4.1-dirty on communications.apk
I: Loading resource table...
I: Decoding AndroidManifest.xml with resources...
I: Loading resource table from file: /root/.local/share/apktool/framework/1.apk
I: Regular manifest package...
I: Decoding file-resources...
I: Decoding values */* XMLs...
I: Baksmaling classes.dex...
I: Copying assets and libs...
I: Copying unknown files...
I: Copying original files...
```

Looking through the files, i was overwhelmed as it was lot of files, and all i was getting was unreadable **.smali** files. Again, googling for bit showed me other tool that does decompiling very well. I used [Online Java Decompiler](http://www.javadecompilers.com/apk) and got nice looking .java files. I got the second flag `FLAG{a445c73c8cb97421d1923a8c51c221fd}` by doing `grep -ir "FLAG"`. I was tired then and went to sleep.

# Flag 3
Third flag was difficult to find. I did dynamic analysis but it errored out when using the app. Going through all **.java** files, **MainActivity.java** was interesting. I found two different endpoints `/d41d8cd98f00b204e9800998ecf8427e/8cd98f00b204e9800998/forgotpassword` and `/fa694c73da13c94e49cc82b/06a28bdb78b6c02e16862a3/chat` from two different functions.

![Apk Code](/writeups/assets/images/bugcrowd0x07_apk_code.png)

Going to forgotpassword endpoint, i can enumerate users from its error message and chat endpoint was forbidden to access as i wasnt authorized. Looking at the source code again, there is some sort of authentication mechanism by using header `3NCRYPT3D-CH4T`.So, i looked more and more into java files and finally found its key through grep.
```
root@kali-linux:~/tmp/CTF/Bugcrowd0x07/source/source_code# rgrep "ENCRYPTED" -i
sources/com/example/levelup/MainActivity.java:    public void encryptedChat() {
sources/com/example/levelup/MainActivity.java:        String key = getApplicationContext().getString(R.string.encrypted_chat_key);
sources/com/example/levelup/C0262R.java:        public static final int encrypted_chat_key = 2131492892;
sources/com/example/helloworld/R.java:        public static final int encrypted_chat_key = 2131492892;
Binary file resources/classes.dex matches
resources/res/values/strings.xml:    <string name="encrypted_chat_key">8b0955d2682eb74347b9e71ea0558c67</string>
resources/res/values/public.xml:    <public type="string" name="encrypted_chat_key" id="2131492892" />
```
So, now we have header and key, we can
